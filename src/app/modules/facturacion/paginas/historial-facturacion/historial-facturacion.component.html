<div class="mb-2">
  <app-paginador
    (pageChange)="cambiarPaginacion($event)"
    [totalItems]="totalItems"
    [currentPage]="currentPage()"
  ></app-paginador>
</div>

<div class="table-responsive">
  <table class="table table-row-bordered align-middle gy-4 gs-9">
    <thead
      class="border-bottom border-gray-200 fs-6 text-gray-600 fw-bold bg-light bg-opacity-75"
    >
      <tr class="fw-bold text-gray-800">
        <th>#</th>
        <th>Tipo</th>
        <th>Fecha</th>
        <th>Descripci√≥n</th>
        <th>Fecha consumo desde</th>
        <th>Fecha consumo hasta</th>
        <th>Total</th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let movimiento of movientos">
        <td>{{ movimiento.id }}</td>
        <td>{{ movimiento.tipo }}</td>
        <td>{{ movimiento.fecha | date: "yyyy-MM-dd" }}</td>
        <td>{{ movimiento.descripcion }}</td>
        <td>{{ movimiento.fecha_desde_consumo | date: "yyyy-MM-dd" }}</td>
        <td>{{ movimiento.fecha_hasta_consumo | date: "yyyy-MM-dd" }}</td>
        <td class="text-end">$ {{ movimiento.vr_total_operado | number }}</td>
        <td class="text-center">
          @if (movimiento.tipo === 'PEDIDO') {
          <span 
            class="cursor-pointer text-primary fw-bold"
            (click)="abrirModal(verConsumoModal, movimiento)"
          >
            Ver consumo
          </span>
          }
        </td>
        <td class="text-center">
          @if (movimiento.factura_id) {
            <i
              placement="end"
              ngbTooltip="Descargar documento"
              class="fa-solid fa-download cursorPointer"
              (click)="descargarDocumento(movimiento.id)"
            ></i>
          }
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Modal para ver consumo -->
<ng-template #verConsumoModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      Detalle de consumos
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <app-ver-consumo-usuario [movimientoSeleccionado]="movimientoSeleccionado()"></app-ver-consumo-usuario>
  </div>
</ng-template>