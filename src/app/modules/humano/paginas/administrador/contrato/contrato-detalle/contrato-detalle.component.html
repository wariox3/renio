<div class="encabezadoDetalle">
  <section class="encabezadoDetalleBotonera">
    <div class="btn-group btn-sm shadow-sm">
      <app-comun-btn-atras />
    </div>
    <div class="btn-group btn-sm shadow-sm">
      <button
        *ngIf="!contrato.estado_terminado"
        type="submit"
        class="btn btn-primary btn-sm"
        #btnGuardar
        translate="FORMULARIOS.BOTONES.COMUNES.TERMINAR"
        (click)="abrirModal(modalTerminacion)"
      ></button>

      <div
        class="btn-group"
        ngbDropdown
        autoClose="outside"
        #OpcionesDropdown="ngbDropdown"
      >
        <button
          type="button"
          class="btn btn-sm btn-flex bg-body btn-color-gray-700 btn-active-primary btn-text-primary"
          id="dropdownBasic1"
          ngbDropdownToggle
        >
          Utilidades
        </button>
        <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
          <button
            ngbDropdownItem
            (click)="abrirModalParametrosIniciales(parametrosIniciales)"
          >
            Parametros iniciales
          </button>
        </div>
      </div>
    </div>
  </section>
</div>
<app-card>
  <section card-titulo>
    <app-comun-titulo-accion [nombreModelo]="'contrato'"></app-comun-titulo-accion>
  </section>
  <section card-body>
    <div class="table-responsive-sm">
      <table class="table table-bordered table-sm">
        <tbody>
          <tr>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.COMUNES.EMPLEADO"
            ></td>
            <td>{{ contrato.contacto_nombre_corto }}</td>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.COMUNES.NUMEROIDENTIFICACION"
            ></td>
            <td colspan="5">{{ contrato.contacto_numero_identificacion }}</td>
          </tr>
          <tr>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.FECHADESDE"
            ></td>
            <td>{{ contrato.fecha_desde }}</td>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.FECHAHASTA"
            ></td>
            <td colspan="5">{{ contrato.fecha_hasta }}</td>
          </tr>
          <tr>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.GRUPO"
            ></td>
            <td>{{ contrato.grupo_nombre }}</td>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.CONTRATOTIPO"
            ></td>
            <td colspan="5">{{ contrato.contrato_tipo_nombre }}</td>
          </tr>
          <tr>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.COMUNES.CIUDADCONTRATO"
            ></td>
            <td>{{ contrato.ciudad_contrato_nombre }}</td>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.COMUNES.CIUDADLABORA"
            ></td>
            <td colspan="5">{{ contrato.ciudad_labora_nombre }}</td>
          </tr>
          <tr></tr>
          <tr>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.SALARIO"
            ></td>
            <td>{{ contrato.salario }}</td>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.COMENTARIO"
            ></td>
            <td colspan="5">{{ contrato.comentario }}</td>
          </tr>
          <tr>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.AUXILIOTRANSPORTE"
            ></td>
            <td>{{ contrato.auxilio_transporte ? "SI" : "NO" }}</td>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.SALARIOINTEGRAL"
            ></td>
            <td>{{ contrato.salario_integral ? "SI" : "NO" }}</td>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.ESTADOTERMINADO"
            ></td>
            <td>{{ contrato.estado_terminado ? "SI" : "NO" }}</td>
          </tr>
          <tr>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.FECHAULTIMOPAGO"
            ></td>
            <td>
              {{ contrato.fecha_ultimo_pago }}
            </td>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.FECHAULTIMOPAGOPRIMA"
            ></td>
            <td colspan="5">
              {{ contrato.fecha_ultimo_pago_prima }}
            </td>
          </tr>
          <tr>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.FECHAULTIMOPAGOVACACIONES"
            ></td>
            <td>
              {{ contrato.fecha_ultimo_pago_vacacion }}
            </td>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.FECHAULTIMOPAGOCESANTIA"
            ></td>
            <td colspan="5">
              {{ contrato.fecha_ultimo_pago_cesantia }}
            </td>
          </tr>
          <tr>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.TIEMPO"
            ></td>
            <td colspan="12">{{ contrato.tiempo_nombre }}</td>
          </tr>
          <tr>
            <td
              class="fw-bold text-gray-800 fs-6 bg-gray-100"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.CARGO"
            ></td>
            <td colspan="12">{{ contrato.cargo_nombre }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</app-card>

<app-card>
  <section card-titulo>
    {{
      "FORMULARIOS.CAMPOS.GENERAL.CONTRATO.INFORMACIONSEGURIDADSOCIAL"
        | translate
    }}
  </section>
  <section card-body>
    <table class="table table-bordered table-sm">
      <tbody>
        <tr>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.TIPOCOTIZANTE"
          ></td>
          <td>{{ contrato.tipo_cotizante_nombre }}</td>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.SUBTIPOCOTIZANTE"
          ></td>
          <td>{{ contrato.subtipo_cotizante_nombre }}</td>
        </tr>
        <tr>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.HUMANO.ADICIONAL.TIPOSALUD"
          ></td>
          <td>{{ contrato.salud_nombre }}</td>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.HUMANO.ADICIONAL.ENTIDADSALUD"
          ></td>
          <td>{{ contrato.entidad_salud_nombre }}</td>
        </tr>
        <tr>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.HUMANO.ADICIONAL.TIPOPENSION"
          ></td>
          <td>{{ contrato.pension_nombre }}</td>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.HUMANO.ADICIONAL.ENTIDADPENSION"
          ></td>
          <td>{{ contrato.entidad_pension_nombre }}</td>
        </tr>
        <tr>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.HUMANO.ADICIONAL.ENTIDADCAJA"
          ></td>
          <td>{{ contrato.entidad_caja_nombre }}</td>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.HUMANO.ADICIONAL.ENTIDADCESANTIAS"
          ></td>
          <td>{{ contrato.entidad_cesantias_nombre }}</td>
        </tr>
        <tr></tr>
        <tr>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.RIESGO"
          ></td>
          <td>{{ contrato.riesgo_nombre }}</td>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.SUCURSAL"
          ></td>
          <td>{{ contrato.sucursal_nombre }}</td>
        </tr>
      </tbody>
    </table>
  </section>
</app-card>

<app-card>
  <section card-titulo>
    {{
      "FORMULARIOS.CAMPOS.GENERAL.CONTRATO.CONTABILIDAD"
        | translate
    }}
  </section>
  <section card-body>
    <table class="table table-bordered table-sm">
      <tbody>
        <tr>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.TIPOCOSTO"
          ></td>
          <td span="2">{{ contrato.tipo_costo_nombre }}</td>
          <td
            class="fw-bold text-gray-800 fs-6 bg-gray-100"
            translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.GRUPO"
          ></td>
          <td>{{ contrato.grupo_contabilidad_nombre }}</td>
        </tr>
      </tbody>
    </table>
  </section>
</app-card>

<ng-template #modalTerminacion let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      {{ tituloModal }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="formularioTerminar">
      <div class="">
        <div class="row mb-5">
          <div class="col-12">
            <label
              class="form-label required"
              translate="FORMULARIOS.CAMPOS.GENERAL.CONTRATO.FECHATERMINACION"
            ></label>
            <input
              #fechaDesde
              formControlName="fecha_terminacion"
              class="form-control"
              type="date"
              autocomplete="off"
              [ngClass]="{
                'is-invalid':
                  formularioTerminar.controls['fecha_terminacion'].touched &&
                  formularioTerminar.controls['fecha_terminacion'].invalid,
                'is-valid':
                  formularioTerminar.controls['fecha_terminacion'].touched &&
                  formularioTerminar.controls['fecha_terminacion'].valid,
              }"
            />
            <ng-container
              [ngTemplateOutlet]="formError"
              [ngTemplateOutletContext]="{
                validation: 'required',
                message:
                  'FORMULARIOS.VALIDACIONES.COMUNES.REQUERIDO' | translate,
                control: formularioTerminar.controls['fecha_terminacion'],
              }"
            ></ng-container>
            <div
              *ngIf="
                formularioTerminar.controls.fechaDesde?.touched &&
                formularioTerminar.controls.fechaDesde?.hasError(
                  'fechaSuperiorNoValida'
                )
              "
            >
              <div class="fv-plugins-message-container">
                <div class="fv-help-block">
                  <span
                    translate="FORMULARIOS.VALIDACIONES.FACTURA.FECHASUPERIOAFECHAVENCIMINETO"
                    role="alert"
                  >
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-end">
          <button
            type="button"
            class="btn btn-sm btn-flex btn-primary"
            #btnGuardar
            (click)="evniarFormularioTerminar()"
          >
            Terminar
          </button>
        </div>
      </div>
    </form>
  </div>
</ng-template>
<ng-template
  #formError
  let-control="control"
  let-message="message"
  let-validation="validation"
  let-cantidadCaracteres="cantidadCaracteres"
>
  <ng-container
    *ngIf="control.hasError(validation) && (control.dirty || control.touched)"
  >
    <div class="fv-plugins-message-container">
      <div class="fv-help-block">
        <span role="alert"> {{ message }} {{ cantidadCaracteres }} </span>
      </div>
    </div>
  </ng-container>
</ng-template>

<ng-template #parametrosIniciales let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Parametros iniciales</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="formularioParametrosIniciales">
      <div class="row mb-5">
        <div class="col-12 col-md-6">
          <label class="form-label required">Fecha último pago</label>
          <input
            #fechaDesde
            formControlName="fecha_ultimo_pago"
            class="form-control"
            type="date"
            autocomplete="off"
            [ngClass]="{
              'is-invalid':
                formularioParametrosIniciales.controls['fecha_ultimo_pago']
                  .touched &&
                formularioParametrosIniciales.controls['fecha_ultimo_pago']
                  .invalid,
              'is-valid':
                formularioParametrosIniciales.controls['fecha_ultimo_pago']
                  .touched &&
                formularioParametrosIniciales.controls['fecha_ultimo_pago']
                  .valid,
            }"
          />
          <ng-container
            [ngTemplateOutlet]="formError"
            [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'FORMULARIOS.VALIDACIONES.COMUNES.REQUERIDO' | translate,
              control:
                formularioParametrosIniciales.controls['fecha_ultimo_pago'],
            }"
          ></ng-container>
          <div
            *ngIf="
              formularioParametrosIniciales.controls.fechaDesde?.touched &&
              formularioParametrosIniciales.controls.fechaDesde?.hasError(
                'fechaSuperiorNoValida'
              )
            "
          >
            <div class="fv-plugins-message-container">
              <div class="fv-help-block">
                <span
                  translate="FORMULARIOS.VALIDACIONES.FACTURA.FECHASUPERIOAFECHAVENCIMINETO"
                  role="alert"
                >
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <label class="form-label required">Fecha último pago prima</label>
          <input
            #fechaDesde
            formControlName="fecha_ultimo_pago_prima"
            class="form-control"
            type="date"
            autocomplete="off"
            [ngClass]="{
              'is-invalid':
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_prima'
                ].touched &&
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_prima'
                ].invalid,
              'is-valid':
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_prima'
                ].touched &&
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_prima'
                ].valid,
            }"
          />
          <ng-container
            [ngTemplateOutlet]="formError"
            [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'FORMULARIOS.VALIDACIONES.COMUNES.REQUERIDO' | translate,
              control:
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_prima'
                ],
            }"
          ></ng-container>
          <div
            *ngIf="
              formularioParametrosIniciales.controls.fechaDesde?.touched &&
              formularioParametrosIniciales.controls.fechaDesde?.hasError(
                'fechaSuperiorNoValida'
              )
            "
          >
            <div class="fv-plugins-message-container">
              <div class="fv-help-block">
                <span
                  translate="FORMULARIOS.VALIDACIONES.FACTURA.FECHASUPERIOAFECHAVENCIMINETO"
                  role="alert"
                >
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mb-5">
        <div class="col-12 col-md-6">
          <label class="form-label required">
            Fecha último pago cesantía
          </label>
          <input
            #fechaDesde
            formControlName="fecha_ultimo_pago_cesantia"
            class="form-control"
            type="date"
            autocomplete="off"
            [ngClass]="{
              'is-invalid':
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_cesantia'
                ].touched &&
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_cesantia'
                ].invalid,
              'is-valid':
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_cesantia'
                ].touched &&
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_cesantia'
                ].valid,
            }"
          />
          <ng-container
            [ngTemplateOutlet]="formError"
            [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'FORMULARIOS.VALIDACIONES.COMUNES.REQUERIDO' | translate,
              control:
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_cesantia'
                ],
            }"
          ></ng-container>
          <div
            *ngIf="
              formularioParametrosIniciales.controls.fechaDesde?.touched &&
              formularioParametrosIniciales.controls.fechaDesde?.hasError(
                'fechaSuperiorNoValida'
              )
            "
          >
            <div class="fv-plugins-message-container">
              <div class="fv-help-block">
                <span
                  translate="FORMULARIOS.VALIDACIONES.FACTURA.FECHASUPERIOAFECHAVENCIMINETO"
                  role="alert"
                >
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <label class="form-label required">
            Fecha último pago vacacion
          </label>
          <input
            #fechaDesde
            formControlName="fecha_ultimo_pago_vacacion"
            class="form-control"
            type="date"
            autocomplete="off"
            [ngClass]="{
              'is-invalid':
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_vacacion'
                ].touched &&
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_vacacion'
                ].invalid,
              'is-valid':
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_vacacion'
                ].touched &&
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_vacacion'
                ].valid,
            }"
          />
          <ng-container
            [ngTemplateOutlet]="formError"
            [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'FORMULARIOS.VALIDACIONES.COMUNES.REQUERIDO' | translate,
              control:
                formularioParametrosIniciales.controls[
                  'fecha_ultimo_pago_cesantia'
                ],
            }"
          ></ng-container>
          <div
            *ngIf="
              formularioParametrosIniciales.controls.fechaDesde?.touched &&
              formularioParametrosIniciales.controls.fechaDesde?.hasError(
                'fechaSuperiorNoValida'
              )
            "
          >
            <div class="fv-plugins-message-container">
              <div class="fv-help-block">
                <span
                  translate="FORMULARIOS.VALIDACIONES.FACTURA.FECHASUPERIOAFECHAVENCIMINETO"
                  role="alert"
                >
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <button
          translate="FORMULARIOS.BOTONES.COMUNES.GUARDAR"
          type="submit"
          class="btn btn-primary btn-sm"
          (click)="enviarFormulario()"
        ></button>
      </div>
    </form>
  </div>
</ng-template>
